##
# Log HIVE query messages
# Set hive configuration files
#
LOG=$_ETL_LOG_PATH/`date +%H%M%S-$RANDOM`.log
hive\
    -hiveconf hive.root.logger=ERROR,console\
    -hiveconf hive.querylog.location=$_ETL_LOG_PATH/hive\
    "$@" &> $LOG

if `cat $LOG | grep -iE "EXCEPTION|FAIL|FATAL|Could not open" 1>/dev/null 2>&1`
then
    echo Error executing query:
    tail -n 25 $LOG
    echo Full log: $LOG
    echo ' '
else
    echo 'Executed query successfully.'
    tail -n 25 $LOG | grep 'Rows loaded'
    tail -n 25 $LOG | grep 'Time taken'
    echo ' '
fi
